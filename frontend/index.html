<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Open Stock Ledger</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <header>
    <h1>Open Stock Ledger</h1>
    <div class="tenant">
      <label for="tenantId">Tenant ID</label>
      <div class="tenant-input">
        <input id="tenantId" value="" placeholder="UUID"/>
        <button type="button" id="tenantApply">Set</button>
      </div>
      <small id="tenantStatus" class="tenant-status"></small>
    </div>
  </header>

  <section>
    <h2>Product Search</h2>
    <form hx-get="/api/products" hx-target="#productResults" hx-trigger="submit">
      <input type="text" name="q" placeholder="SKU or text..." />
      <button>Search</button>
    </form>
    <div id="productResults" class="panel"></div>
  </section>

  <section>
    <h2>Create Order</h2>
    <form id="createOrderForm" onsubmit="return createOrder(event)">
      <input type="text" id="productId" placeholder="product_id (UUID)" required>
      <input type="number" id="qty" placeholder="qty" min="1" required>
      <button>Create</button>
    </form>
    <pre id="orderOut" class="panel"></pre>
  </section>

  <section>
    <h2>Allocate Order</h2>
    <form id="allocForm" onsubmit="return allocate(event)">
      <input type="text" id="orderId" placeholder="order_id (UUID)" required>
      <button>Allocate</button>
      <button type="button" onclick="return releaseOrder(event)">Release Holds</button>
    </form>
    <pre id="allocOut" class="panel"></pre>
  </section>

<section>
  <h2>Current Stock (by product)</h2>
  <form
    hx-get="/ui/current_stock_table"
    hx-target="#stockTable"
    hx-trigger="submit"
    hx-headers='js:{"X-Tenant-Id": document.getElementById("tenantId").value}'
  >
    <input type="text" name="product_id" placeholder="product_id (UUID)" required>
    <button>Fetch</button>
  </form>
  <div style="margin:.5rem 0;">
    <button
      hx-post="/admin/refresh_mv"
      hx-target="#stockTable"
      hx-headers='js:{"X-Admin-Token": window.ADMIN_TOKEN || ""}'
    >Refresh MV</button>
  </div>
  <div id="stockTable" class="panel"></div>
</section>

  <script src="/app.js"></script>
</body>
</html>

